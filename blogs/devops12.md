# 【学习笔记】持续集成CI | 落地篇08

> CI 是一种软件开发实践。
>
> 团队成员频繁地将他们的工作成果集成到一起（通常每人每天至少提交一次，这样每天就会有多次集成），并且在每次提交后，自动触发运行一次包含自动化验证集的构建任务，以便尽早地发现集成问题。

软件集成是一件高风险的、不确定的事情，国外甚至有个专门的说法，叫做“集成地狱”。

CI 采用了一种反常规的思路来解决软件集成的困境，其核心理念就是：越是痛苦的事情，就要越频繁地做。

> 如果软件集成有这么大的风险和不确定性，那不如把集成的频率提高，让每次集成的内容减少，这样即便失败，影响的也仅仅是一次小的集成内容，问题定位和修复都可以更加快速地完成。

判断团队是否做到了CI，可以问 3 个问题：

1. 每一次代码提交，是否都会触发一次完整的流水线？
2. 每次流水线是否会触发自动化的测试环节？
3. 如果流水线出现了问题，是否能够在 10 分钟之内修复？

拿负责的项目判断一下：

1. 0.5 分。需要手工触发，开发流水线没有进行sonar/fortify的扫描；
2. 0.2 分。触发自动化接口测试，但是测试案例库的建设还没跟上；
3. 0.2 分。流水线系统是内部系统，没有RTO。

就上面的三个灵魂拷问，作者展开进一步论述，原来这是渐进的三个阶段。

## 第一阶段：每次提交触发完整的流水线

第一个阶段的关键词是：**快速集成**。

**统一的分支策略**：需要有一条以集成为目的的分支；

**清晰的集成规则**：对于不同分支来说，持续集成的步骤和要求也不尽相同。不同分支的集成目的不同，相应的环节自然也不相同；

**标准化的资源池**：任何任务在任何节点都具备可运行的能力；

**足够快的反馈周期**：CI 的运行速度是一个需要纳入监控的重要指标

## 第二阶段：每次流水线触发自动化测试

第二个阶段的关键词是：**质量内建**。

**匹配合适的测试活动：**不同层级的 CI 需要根据集成规则来确定需要注入的质量活动；

**树立测试结果的公信度：**对 CI 失败进行分类分级，并进行相应的持续优化和改善；

**提升测试活动的有效性：**与第一点类似，为提升发现问题的效率，测试任务做到与变更点关联；

## 第三阶段：出了问题可以在第一时间修复

这个阶段的关键词是：**建立机制**。

10分钟，在这么短的时间里，人为因素其实并不可控，所以，**人不是关键，建立机制才是关键**。



作者最后强调，避免陷入工具决定论的怪圈。工具是实践的载体，实践是工具的根基，单纯的工具建设仅仅是千里之行的一小步。

对CI来说是如此；对Devops来说也是如此。

## Reference

- [DevOps实战笔记](https://time.geekbang.org/column/intro/235?code=GC0JpoFVv4WPkRF1zJR2ApOvhfke36rvSRJoaCEOd50%3D&utm_term=SPoster)